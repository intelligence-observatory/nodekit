<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>NodeKit Preview Page</title>
    <link rel="shortcut icon" href="">

    <!-- NodeKit runtime assets -->
    <script src="{{ nodekit_javascript_link }}"></script>
    <link href="{{ nodekit_css_link }}" rel="stylesheet">

    <script>
        // NodeGraph and AssetURLs:
        const nodeGraph = {{ node_graph | tojson(indent=4) | indent(8, first=False) }};
        const assetUrls = {{ asset_urls | tojson(indent=4) | indent(8, first=False) }};

        // Submit URL injected from FastAPI
        const submitUrl = "{{ submit_event_url }}";

        async function sendEvent(ev) {
            console.log(ev)
            try {
                await fetch(submitUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(ev),
                });
            } catch (err) {
                console.error("Failed to send event", err);
            }
        }

        window.onload = async () => {
            // Start NodeKit playback
            await NodeKit.play(
                nodeGraph,
                assetUrls,
                sendEvent
            );
        };
    </script>
</head>
<body></body>
</html>