<!doctype html>
<html lang="en">
<head>
    <link rel="icon" href="data:,">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Test</title>
</head>
<body>
<script src="../dist/nodekit.js"></script>
<link rel="stylesheet" href="../dist/nodekit.css">
<script>
    const videoAsset = {
        sha256: "3f224a8b6a7917ae1364cf2cc9daf7a5f7073bfe0fb5d9b638d8a6efc1c867f7",
        media_type: "video/mp4",
        locator: {
            locator_type: "RelativePath",
            relative_path: "./test-video.mp4"
        }
    };

    const videoCard = {
        card_type: "VideoCard",
        video: videoAsset,
        loop: false,
        region: {
            x: 0,
            y: 0,
            w: 480,
            h: 320,
            z_index: null,
            mask: "rectangle"
        }
    };

    const graph = {
        type: "Graph",
        nodekit_version: "0.0.0",
        nodes: {
            "video-node": {
                type: "Node",
                stimulus: videoCard,
                sensor: {
                    sensor_type: "SelectSensor",
                    choices: {
                        video: videoCard,
                    },
                },
                board_color: "#808080ff",
                hide_pointer: false,
                annotation: "",
            },
        },
        transitions: {},
        start: "video-node",
        registers: {},
    };

    window.__graph = graph;
    window.__events = [];
    window.__trace = null;
    window.__error = null;

    window.onload = async () => {
        // Align the graph version with the runtime to avoid semver gating issues.
        graph.nodekit_version = NodeKit.version;

        try {
            window.__trace = await NodeKit.play(
                graph,
                (event) => {
                    window.__events.push(event);
                    console.log(event);
                },
                false,
            );
        } catch (err) {
            window.__error = err;
            console.error(err);
        }
    };
</script>

</body>
</html>
