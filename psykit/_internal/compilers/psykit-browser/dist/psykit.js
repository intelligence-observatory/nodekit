(function(e,t){typeof exports=="object"&&typeof module<"u"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(e=typeof globalThis<"u"?globalThis:e||self,t(e.EventClient={}))})(this,(function(e){"use strict";var c=Object.defineProperty;var p=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var i=(e,t,r)=>p(e,typeof t!="symbol"?t+"":t,r);class t{constructor(n,s){i(this,"connectionUrl");i(this,"runId");this.connectionUrl=s,this.runId=n}async postEventCore(n){const s=new AbortController,d=setTimeout(()=>s.abort(),5e3);let o;try{o=await fetch(this.connectionUrl,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"},signal:s.signal})}catch(l){throw new Error(`Fetch error: ${l}`)}finally{clearTimeout(d)}if(!o.ok)throw new Error(`Protocol error: got bad response: ${o.status} ${o.statusText}`);let a;if((o.headers.get("content-type")||"").includes("application/json"))a=await o.json();else throw new Error(`Protocol error: expected Content-Type application/json: ${o.status} ${o.statusText}`);return{response:a,status:o.status,ok:o.ok}}getEventId(){return crypto.randomUUID()}getTimestamp(){return new Date().toISOString()}async sendStartEvent(){let n={run_id:this.runId,event_id:this.getEventId(),event_type:"StartEvent",event_payload:{},event_timestamp:this.getTimestamp()};return console.log("start event",n),this.postEventCore(n)}async sendNodeResultEvent(n){const s={run_id:this.runId,event_id:this.getEventId(),event_type:"NodeResultEvent",event_payload:n,event_timestamp:this.getTimestamp()};return console.log("start event",s),this.postEventCore(s)}async sendEndEvent(){let n={run_id:this.runId,event_id:this.getEventId(),event_type:"EndEvent",event_payload:{},event_timestamp:this.getTimestamp()};return console.log("end event",n),this.postEventCore(n)}}typeof window<"u"&&(window.EventClient=t),e.EventClient=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
