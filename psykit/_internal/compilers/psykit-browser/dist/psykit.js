(function(s,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(s=typeof globalThis<"u"?globalThis:s||self,n(s.EventClient={}))})(this,(function(s){"use strict";var d=Object.defineProperty;var l=(s,n,i)=>n in s?d(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i;var o=(s,n,i)=>l(s,typeof n!="symbol"?n+"":n,i);class n{constructor(e,t){o(this,"connectionUrl");o(this,"queue",[]);o(this,"flushing",!1);o(this,"runId");this.connectionUrl=t,this.runId=e}async queueEvent(e){return new Promise((t,u)=>{this.queue.push({event:e,resolve:t,reject:u}),this._maybeFlushNext()})}async sendEventCore(e){var a;let t=await fetch(this.connectionUrl,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}),u=null;t.ok?(a=t.headers.get("content-type"))!=null&&a.includes("application/json")?u=await t.json():console.error("Response is not JSON:",t.headers.get("content-type")):console.error("Failed to post event:",t.status,t.statusText);const r={response:u,status:t.status,ok:t.ok};return console.log("Sent:",e,"Received:",r),r}getTimestamp(){return new Date().toISOString()}_maybeFlushNext(){if(this.flushing)return;const e=this.queue.shift();e&&(this.flushing=!0,this.sendEventCore(e.event).then(t=>{t.ok?e.resolve(t):this.queue.unshift(e)}).catch(t=>{console.warn("Fetch error, requeuing:",t),this.queue.unshift(e)}).finally(()=>{this.flushing=!1,this._maybeFlushNext()}))}getEventId(){return crypto.randomUUID()}async sendStartEvent(){let e={run_id:this.runId,event_id:this.getEventId(),event_type:"StartEvent",event_payload:{},event_timestamp:this.getTimestamp()};return await this.queueEvent(e)}async sendNodeResultEvent(e){const t={run_id:this.runId,event_id:this.getEventId(),event_type:"NodeResultEvent",event_payload:e,event_timestamp:this.getTimestamp()};return await this.queueEvent(t)}async sendEndEvent(){let e={run_id:this.runId,event_id:this.getEventId(),event_type:"EndEvent",event_payload:{},event_timestamp:this.getTimestamp()};return await this.queueEvent(e)}}typeof window<"u"&&(window.EventClient=n),s.EventClient=n,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));
